<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bitc.fullstack503.server.mapper.WHMapper">

    <!--  물류센터 재고 조회  -->
    <select id="selectWHStock"  resultType="bitc.fullstack503.ordernetserver.dto.WH2DTO">
        select parts.part_id, parts.part_name, parts.part_cate, warehouse_stock.stock_quantity, parts.part_price
        from warehouse_stock
        join parts
        on warehouse_stock.part_id=parts.part_id
<!--        where warehouse_stock.warehouse_id = "WH_ENG/PT"-->
        WHERE warehouse_stock.warehouse_id = #{warehouseId}
    </select>

    <!--  물류센터 입고 조회  -->
    <select id="selectWHComeIn" resultType="bitc.fullstack503.ordernetserver.dto.WH2DTO">
        select parts.part_id, parts.part_name, parts.part_price,parts.part_cate, warehouse_inbound.inbound_quantity,warehouse_inbound.inbound_date
        from warehouse_inbound
        join parts
        on warehouse_inbound.part_id=parts.part_id
<!--        where warehouse_inbound.warehouse_id='WH_ENG/PT'-->
        WHERE warehouse_inbound.warehouse_id = #{warehouseId}
    </select>

    <!--  물류센터 출고 관리 - 주문 정보 가져오기  -->
    <select id="selectWHManage" resultType="bitc.fullstack503.ordernetserver.dto.WH2DTO">
        SELECT
        oi.order_item_id, oi.order_id, oi.part_id, p.part_name, p.part_cate, oi.order_item_quantity,
        b.branch_name, oi.order_item_status, o.order_due_date
        FROM
        order_item oi
        LEFT JOIN
        parts p ON oi.part_id = p.part_id
        LEFT JOIN
        orders o ON oi.order_id = o.order_id
        LEFT JOIN
        branch b ON o.branch_id = b.branch_id
        LEFT JOIN
        warehouse_stock ws ON oi.part_id = ws.part_id AND ws.warehouse_id = #{userId}
        WHERE
        ws.warehouse_id IS NOT NULL
        ORDER BY
        CASE oi.order_item_status
        WHEN '출고대기' THEN 0
        ELSE 1
        END,
        o.order_due_date ASC
    </select>


    <update id="updateOrderStatus" parameterType="map">
        UPDATE order_item
        SET order_item_status = #{orderItemStatus}
        WHERE order_item_id =#{orderItemId}
    </update>




</mapper>