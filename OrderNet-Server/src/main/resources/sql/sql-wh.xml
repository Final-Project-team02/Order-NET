<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bitc.fullstack503.ordernetserver.mapper.WHMapper">

    <!--  물류센터 재고 조회  -->
    <select id="selectWHStock"  resultType="bitc.fullstack503.ordernetserver.dto.WHDTO">
        select parts.part_id, parts.part_name, parts.part_cate, warehouse_stock.stock_quantity, parts.part_price
        from warehouse_stock
        join parts
        on warehouse_stock.part_id=parts.part_id
        where warehouse_stock.warehouse_id = "WH_ENG/PT"
    </select>

    <!--  물류센터 입고 조회  -->
    <select id="selectWHComeIn" resultType="bitc.fullstack503.ordernetserver.dto.WHDTO">
        select parts.part_id, parts.part_name , parts.part_price,parts.part_cate, warehouse_inbound.inbound_quantity,warehouse_inbound.inbound_date
        from warehouse_inbound
        join parts
        on warehouse_inbound.part_id=parts.part_id
        where warehouse_inbound.warehouse_id='WH_ENG/PT'
    </select>


    <select id="getMonthlyOutboundPartsByWarehouse" resultType="bitc.fullstack503.ordernetserver.dto.WHDTO">
        SELECT
        oi.part_id AS partId,
        p.part_name AS partName,
        p.part_cate AS partCate,
        p.part_price AS partPrice,
        ws.stock_quantity AS stockQuantity,  -- 여기 수정
        SUM(oi.order_item_quantity) AS totalQuantity
        FROM
        warehouse_outbound wo
        JOIN
        order_item oi ON wo.order_id = oi.order_id
        JOIN
        parts p ON oi.part_id = p.part_id
        JOIN
        warehouse_stock ws ON ws.part_id = p.part_id AND ws.warehouse_id = wo.warehouse_id  -- 새로 추가된 JOIN
        WHERE
        wo.warehouse_id = #{warehouseId}
        AND MONTH(wo.outbound_date) = #{month}
        AND YEAR(wo.outbound_date) = #{year}
        GROUP BY
        oi.part_id, p.part_name, p.part_cate, p.part_price, ws.stock_quantity;

    </select>




</mapper>