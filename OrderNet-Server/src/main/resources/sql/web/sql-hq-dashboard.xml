<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bitc.fullstack503.ordernetserver.mapper.HQDashBoardMapper">

    <!--  대리점 정보 가져오기  -->
    <select id="selectBranchInfo" resultType="bitc.fullstack503.ordernetserver.dto.ClientDTO">
        select branch_name, branch_supervisor, branch_phone, branch_zip_code, branch_road_addr
        from branch
    </select>

    <!--  공지 조회  -->
    <select id="selectNoticeList" resultType="bitc.fullstack503.ordernetserver.dto.NoticeDTO">
        select notice_id, notice_title, notice_content, notice_write_date, user_id
        from notice
        order by notice_write_date desc
    </select>

    <!--  공지 작성  -->
    <insert id="insertNotice" parameterType="bitc.fullstack503.ordernetserver.dto.NoticeDTO">
        insert into notice (notice_title, notice_content, notice_write_date, user_id)
        values (#{noticeTitle}, #{noticeContent}, CURRENT_DATE, #{userId})
    </insert>

    <!--  공지 수정  -->
    <delete id="deleteNotice" parameterType="String">
        DELETE FROM notice
        where notice_id = #{noticeId}
    </delete>

    <!--    주문 현황 -->
    <select id="selectOrderStatusStats" resultType="bitc.fullstack503.ordernetserver.dto.OrderStatusStatsDTO">
        SELECT
        COUNT(*) AS totalOrders,
        SUM(CASE WHEN order_status = '출고' THEN 1 ELSE 0 END) AS shippedOrders,
        SUM(CASE WHEN order_status = '반려' THEN 1 ELSE 0 END) AS deniedOrders,
        SUM(CASE WHEN order_status = '승인 대기' THEN 1 ELSE 0 END) AS pendingOrders
        FROM orders
    </select>

    <!--    대리점별 월간 매출 추이 그래프-->
    <select id="getMonthlySalesByBranch" resultType="bitc.fullstack503.ordernetserver.dto.OrderMonthlySalesDTO">
        SELECT
        branch_id,
        DATE_FORMAT(order_date, '%Y-%m') AS order_month,
        SUM(order_price) AS total_sales
        FROM orders
        WHERE order_status != '반려'
        GROUP BY branch_id, order_month
        ORDER BY order_month, branch_id
    </select>

</mapper>
